<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>All Customers | Secure Trust Bank</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="/static/js/validation.js"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>

    <style>
      body {
        background: linear-gradient(to bottom right, #f0f9ff, #e6ffe6);
      }
      .dark body {
        background: #0f172a;
      }
      .glass-card {
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(12px);
        border: 1px solid rgba(200, 200, 255, 0.2);
      }
      .dark .glass-card {
        background: rgba(30, 41, 59, 0.7);
        border: 1px solid rgba(100, 116, 139, 0.4);
      }
    </style>

    <script>
      // Apply saved theme on page load
      if (localStorage.getItem("theme") === "dark") {
        document.documentElement.classList.add("dark");
      } else if (!localStorage.getItem("theme")) {
        // Default to system preference
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        if (prefersDark) {
          document.documentElement.classList.add("dark");
          localStorage.setItem("theme", "dark");
        } else {
          localStorage.setItem("theme", "light");
        }
      }

      // Toggle theme + persist
      function toggleTheme() {
        const isDark = document.documentElement.classList.toggle("dark");
        localStorage.setItem("theme", isDark ? "dark" : "light");
      }
    </script>
  </head>
  <body
    class="relative min-h-screen p-6 text-slate-800 dark:text-slate-100 transition duration-300"
  >
    <!-- Manager logout -->
      <a
        href="/manager_logout"
        class="absolute top-2 left-2 px-3 py-1 text-sm text-red-600 rounded-md hover:bg-red-100 hover:text-red-800 transition"
      >
        Logout
      </a>

    <!-- Dark Mode Toggle -->
    <div class="absolute top-4 right-6 z-10">
      <button
        onclick="toggleTheme()"
        class="px-3 py-1 text-sm rounded-md border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-700 transition"
      >
        Switch Theme
      </button>
    </div>

    <!-- Glass Card Container -->
    <div
      class="glass-card p-6 rounded-2xl shadow-xl overflow-auto max-w-7xl mx-auto mt-20"
    >

      <!-- Title moved inside -->
      <h2
        class="text-2xl font-bold text-center text-teal-700 dark:text-teal-300 mb-6"
      >
        ðŸ“Š All Customer Data
      </h2>

      <!-- Search Input -->
      <div class="flex justify-end mb-4">
        <input
          type="text"
          id="searchInput"
          placeholder="Search customers..."
          class="px-4 py-2 border rounded-lg w-full max-w-sm dark:bg-slate-700 dark:border-slate-600 dark:text-white"
        />
      </div>

      <!-- Customer Table -->
      <div class="w-full overflow-x-auto">
        <table
          id="customerTable"
          class="w-full min-w-[1200px] border-collapse bg-white dark:bg-slate-800 rounded-lg overflow-hidden shadow"
        >
          <thead class="bg-teal-600 text-white">
            <tr>
              <th class="p-2 cursor-pointer" onclick="sortTable(0)">
                <div class="flex items-center justify-center gap-1">
                  <span>Name</span>
                  <span class="text-xs text-gray-200 dark:text-gray-400"
                    >â‡…</span
                  >
                </div>
              </th>
              <th class="p-2 cursor-pointer" onclick="sortTable(1)">
                <div class="flex items-center justify-center gap-1">
                  <span>City</span>
                  <span class="text-xs text-gray-200 dark:text-gray-400"
                    >â‡…</span
                  >
                </div>
              </th>

              <th class="p-2 cursor-pointer" onclick="sortTable(2)">
                <div class="flex items-center justify-center gap-1">
                  <span>Date of Birth</span>
                  <span class="text-xs text-gray-200 dark:text-gray-400"
                    >â‡…</span
                  >
                </div>
              </th>

              <th class="p-2">Gender</th>

              <th class="p-2 cursor-pointer" onclick="sortTable(3)">
                <div class="flex items-center justify-center gap-1">
                  <span>Type</span>
                  <span class="text-xs text-gray-200 dark:text-gray-400"
                    >â‡…</span
                  >
                </div>
              </th>
              <th class="p-2 cursor-pointer" onclick="sortTable(5)">
                <div class="flex items-center justify-center gap-1">
                  <span>Amount</span>
                  <span class="text-xs text-gray-200 dark:text-gray-400"
                    >â‡…</span
                  >
                </div>
              </th>

              <th class="p-2">Acc No</th>
              <th class="p-2">Mobile</th>
              <th class="p-2">Created</th>
              <th class="p-2">Deleted?</th>
              <th class="p-2">Deleted On</th>
              <th class="p-2">Email</th>
            </tr>
          </thead>
          <tbody id="tableBody">
            {% for row in data %}
            <tr
              class="text-center border-b dark:border-slate-600 {% if row[8] == 1 %}bg-red-100 dark:bg-red-900{% endif %}"
            >
              <td class="p-2">{{ row[0] }}</td>
              <td class="p-2">{{ row[1] }}</td>
              <td class="p-2">{{ row[2] }}</td>
              <td class="p-2">{{ row[3] }}</td>
              <td class="p-2">{{ row[4] }}</td>
              <td class="p-2">â‚¹{{ row[5] }}</td>
              <td class="p-2">{{ row[6] }}</td>
              <td class="p-2">{{ row[7] }}</td>
              <td class="p-2">{{ row[8] }}</td>
              <td
                class="p-2 font-semibold {% if row[9] == 1 %}text-red-600{% else %}text-green-600{% endif %}"
              >
                {{ "Yes" if row[9] == 1 else "No" }}
              </td>
              <td class="p-2">
                {{ row[10].strftime("%d-%m-%Y %H:%M") if row[10] else "â€”" }}
              </td>
              <td class="p-2">{{ row[11] }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Filter Buttons -->
      <form
        method="POST"
        action="/manager_data"
        class="flex flex-wrap justify-center gap-4 mt-6 pt-4 border-t border-slate-200 dark:border-slate-700"
      >
        <input type="hidden" name="password" value="12345" />
        <button
          name="filter"
          value="all"
          class="px-4 py-2 rounded-xl bg-indigo-600 text-white hover:bg-indigo-700 {{ 'font-bold' if selected == 'all' else '' }}"
        >
          Show All
        </button>
        <button
          name="filter"
          value="active"
          class="px-4 py-2 rounded-xl bg-green-600 text-white hover:bg-green-700 {{ 'font-bold' if selected == 'active' else '' }}"
        >
          Active Only
        </button>
        <button
          name="filter"
          value="deleted"
          class="px-4 py-2 rounded-xl bg-red-600 text-white hover:bg-red-700 {{ 'font-bold' if selected == 'deleted' else '' }}"
        >
          Deleted Only
        </button>
      </form>
    </div>

    <script src="{{ url_for('static', filename='js/session_checker.js') }}"></script>
    <script>
      setupSessionExpiry("{{ expires_at }}");
    </script>

  </body>
</html>
