<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>PIN Login | Secure Trust Bank</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <script>
            tailwind.config = { darkMode: "class" };
        </script>
        <style>
            body {
            background: linear-gradient(to bottom right, #f0f9ff, #e6ffe6);
            }
            .dark body {
            background: #0f172a;
            }
            .glass-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(14px);
            border: 1px solid rgba(200, 200, 255, 0.3);
            }
            .dark .glass-card {
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(100, 116, 139, 0.4);
            }
            @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25%, 75% { transform: translateX(-6px); }
            50% { transform: translateX(6px); }
            }
            .shake {
            animation: shake 0.4s ease-in-out;
            }
        </style>

        <!-- Theme persistence -->
        <script>
            // Apply saved theme on page load
            if (localStorage.getItem("theme") === "dark") {
            document.documentElement.classList.add("dark");
            } else if (!localStorage.getItem("theme")) {
            const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
            if (prefersDark) {
                document.documentElement.classList.add("dark");
                localStorage.setItem("theme", "dark");
            } else {
                localStorage.setItem("theme", "light");
            }
            }

            function toggleTheme() {
            const isDark = document.documentElement.classList.toggle("dark");
            localStorage.setItem("theme", isDark ? "dark" : "light");
            }
        </script>
    </head>

    <body class="min-h-screen flex items-center justify-center px-4 text-slate-800 dark:text-white transition duration-300">

        <!-- Back to Home -->
        <a
        href="/"
        class="absolute top-2 left-2 px-3 py-1 text-sm text-teal-600 rounded-md hover:bg-teal-100 hover:text-teal-800 transition"
        >
        ‚Üê Home
        </a>

        <!-- Theme Toggle -->
        <div class="absolute top-4 right-6 z-10">
            <button
            onclick="toggleTheme()"
            class="px-3 py-1 text-sm rounded-md border border-slate-300 dark:border-slate-600 text-slate-700 dark:text-white hover:bg-slate-100 dark:hover:bg-slate-700 transition"
            >
            Switch Theme
            </button>
        </div>

        <!-- Login Box -->
        <div class="glass-card p-8 rounded-2xl shadow-xl w-full max-w-md text-center mt-10">
            <h2 class="text-2xl font-bold text-blue-700 dark:text-blue-300 mb-4">üîê Login with PIN</h2>

            {% if cooldown %}
            <div class="mb-4 text-red-600 font-semibold">
            Too many incorrect attempts.<br />
            Please wait <span id="countdown">{{ remaining }}</span> seconds.
            </div>
            {% endif %}

            <form method="POST" class="space-y-4 {% if shake %}shake{% endif %}" {% if cooldown %}style="pointer-events: none; opacity: 0.4;"{% endif %}>
            <input
                type="number"
                name="acc_no"
                placeholder="Account Number"
                required
                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:border-slate-600"
            />
            <input
                type="password"
                name="pin"
                placeholder="4-digit PIN"
                maxlength="4"
                pattern="\d{4}"
                required
                class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-slate-800 dark:border-slate-600"
            />
            <button
                class="w-full bg-blue-600 text-white py-2 rounded-md hover:bg-blue-700 transition font-semibold"
            >
                Login
            </button>

            {% if session['pin_attempts'] is defined and not cooldown %}
            <div class="text-xs text-yellow-700 bg-yellow-100 rounded-md px-3 py-1 mt-2 text-center border border-yellow-300 dark:bg-yellow-900 dark:text-yellow-100 dark:border-yellow-800">
                {{ session['pin_attempts'] }}/3 login attempts used
            </div>
            {% endif %}
            </form>
        </div>

        <script>
            // Countdown for cooldown lock
            const countdownEl = document.getElementById("countdown");
            if (countdownEl) {
            let remaining = parseInt(countdownEl.innerText);
            const interval = setInterval(() => {
                remaining -= 1;
                countdownEl.innerText = remaining;
                if (remaining <= 0) location.reload();
            }, 1000);
            }
        </script>

    </body>
</html>
